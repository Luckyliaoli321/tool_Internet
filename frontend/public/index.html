<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <!-- âš ï¸âš ï¸âš ï¸ å…³é”®ä¿®å¤ï¼šå®Œå…¨ç¦ç”¨ç½‘ç»œè¯·æ±‚åŠŸèƒ½ âš ï¸âš ï¸âš ï¸ -->
    <script>
      (function() {
        console.log('ğŸ›‘ æœ€é«˜ä¼˜å…ˆçº§æ‹¦æˆªå™¨å·²å¯åŠ¨');
        
        // ç›®æ ‡URL
        var TARGET_URL = 'localhost:5002/api/file/formats';
        
        // é¢„è®¾æ•°æ®
        var DEFAULT_FORMATS = {
          success: true,
          formats: [
            {name: 'Wordæ–‡æ¡£', extension: 'docx', targetFormats: [{name: 'PDFæ–‡æ¡£', extension: 'pdf'}, {name: 'æ–‡æœ¬æ–‡ä»¶', extension: 'txt'}]},
            {name: 'PDFæ–‡æ¡£', extension: 'pdf', targetFormats: [{name: 'Wordæ–‡æ¡£', extension: 'docx'}, {name: 'æ–‡æœ¬æ–‡ä»¶', extension: 'txt'}]},
            {name: 'Excelè¡¨æ ¼', extension: 'xlsx', targetFormats: [{name: 'CSVæ–‡ä»¶', extension: 'csv'}, {name: 'PDFæ–‡æ¡£', extension: 'pdf'}]},
            {name: 'å›¾ç‰‡', extension: 'jpg', targetFormats: [{name: 'PNGå›¾ç‰‡', extension: 'png'}, {name: 'WebPå›¾ç‰‡', extension: 'webp'}]}
          ]
        };
        
        // ä¿å­˜åˆ°å…¨å±€å˜é‡
        window.__fileFormatsFallback = DEFAULT_FORMATS;
        
        try {
          // ===== æ–¹æ³•1ï¼šå®Œå…¨ç¦ç”¨XHR =====
          var RealXHR = window.XMLHttpRequest;
          
          // å®Œå…¨æ›¿æ¢XHR
          window.XMLHttpRequest = function() {
            var xhr = new RealXHR();
            var origOpen = xhr.open;
            var origSend = xhr.send;
            
            // æ‹¦æˆªopenæ–¹æ³•
            xhr.open = function(method, url) {
              // è®°å½•åŸå§‹URL
              xhr._origUrl = url;
              xhr._method = method;
              console.log('ğŸ” XHRè¯·æ±‚: ' + method + ' ' + url);
              
              if (typeof url === 'string' && url.includes('localhost')) {
                console.warn('âŒ æ‹¦æˆªåˆ°localhostè¯·æ±‚: ' + url);
                
                // å¯¹äºç›®æ ‡URLï¼Œç‰¹æ®Šå¤„ç†
                if (url.includes('file/formats')) {
                  console.log('ğŸ“¦ è¿”å›é¢„è®¾æ ¼å¼æ•°æ®');
                  xhr._isFormatRequest = true;
                  
                  // ä¸æ”¹å˜URLï¼Œåœ¨sendä¸­å¤„ç†
                  return origOpen.apply(xhr, arguments);
                } else {
                  // å…¶ä»–localhostè¯·æ±‚ï¼Œæ”¹ä¸ºä¸€ä¸ªå¿…å®šå¤±è´¥çš„URL
                  return origOpen.call(xhr, method, 'https://request-blocked/');
                }
              }
              
              // å…¶ä»–è¯·æ±‚ä¿æŒä¸å˜
              return origOpen.apply(xhr, arguments);
            };
            
            // æ‹¦æˆªsendæ–¹æ³•
            xhr.send = function() {
              // å¤„ç†æ ¼å¼è¯·æ±‚
              if (xhr._isFormatRequest) {
                console.log('ğŸ“© æ¨¡æ‹Ÿæ ¼å¼è¯·æ±‚çš„å“åº”');
                
                // ä¸å‘é€çœŸå®è¯·æ±‚ï¼Œæ¨¡æ‹Ÿå“åº”
                setTimeout(function() {
                  // è®¾ç½®XHRçŠ¶æ€
                  xhr.readyState = 4;
                  xhr.status = 200;
                  xhr.statusText = 'OK';
                  
                  // è®¾ç½®å“åº”
                  var response = JSON.stringify(DEFAULT_FORMATS);
                  Object.defineProperty(xhr, 'responseText', {value: response});
                  Object.defineProperty(xhr, 'response', {value: response});
                  
                  // è§¦å‘å›è°ƒ
                  var event = new Event('load');
                  xhr.dispatchEvent(event);
                  if (xhr.onload) xhr.onload(event);
                  if (xhr.onreadystatechange) xhr.onreadystatechange();
                }, 0);
                
                return; // ä¸å‘é€å®é™…è¯·æ±‚
              }
              
              // å¤„ç†è¢«é˜»æ­¢çš„è¯·æ±‚
              if (xhr._origUrl && xhr._origUrl.includes('localhost') && !xhr._isFormatRequest) {
                console.log('ğŸš« é˜»æ­¢XHRè¯·æ±‚: ' + xhr._method + ' ' + xhr._origUrl);
                
                // æ¨¡æ‹Ÿé”™è¯¯
                setTimeout(function() {
                  var error = new Error('ç½‘ç»œè¯·æ±‚è¢«é˜»æ­¢');
                  var event = new ProgressEvent('error', {lengthComputable: false});
                  xhr.dispatchEvent(event);
                  if (xhr.onerror) xhr.onerror(event);
                }, 0);
                
                return; // ä¸å‘é€å®é™…è¯·æ±‚
              }
              
              // å¤„ç†å…¶ä»–æ­£å¸¸è¯·æ±‚
              return origSend.apply(xhr, arguments);
            };
            
            return xhr;
          };
          console.log('âœ… XMLHttpRequestå·²å®Œå…¨æ›¿æ¢');
          
          // ===== æ–¹æ³•2ï¼šæ‹¦æˆªFetch =====
          if (window.fetch) {
            var originalFetch = window.fetch;
            window.fetch = function(resource, init) {
              var url = (resource instanceof Request) ? resource.url : resource;
              
              if (typeof url === 'string' && url.includes('localhost')) {
                console.warn('ğŸš« æ‹¦æˆªfetchè¯·æ±‚: ' + url);
                
                // å¯¹äºç›®æ ‡URLï¼Œè¿”å›é¢„è®¾æ•°æ®
                if (url.includes('file/formats')) {
                  console.log('ğŸ“¦ è¿”å›é¢„è®¾æ ¼å¼æ•°æ® (fetch)');
                  return Promise.resolve(new Response(
                    JSON.stringify(DEFAULT_FORMATS),
                    {status: 200, headers: {'Content-Type': 'application/json'}}
                  ));
                }
                
                // å…¶ä»–localhostè¯·æ±‚ï¼Œç›´æ¥æ‹’ç»
                return Promise.reject(new Error('è¯·æ±‚è¢«é˜»æ­¢'));
              }
              
              // å…¶ä»–è¯·æ±‚ä¸å˜
              return originalFetch.apply(window, arguments);
            };
            console.log('âœ… fetchå·²æ‹¦æˆª');
          }
          
          // ===== æ–¹æ³•3ï¼šæ©ç›–é”™è¯¯ =====
          window.addEventListener('error', function(e) {
            if (e.message && (e.message.includes('localhost') || 
                              e.message.includes('Failed to load resource') || 
                              e.message.includes('net::ERR_CONNECTION_REFUSED'))) {
              console.warn('ğŸ™ˆ æŠ‘åˆ¶é”™è¯¯: ' + e.message);
              e.preventDefault();
              return false;
            }
          }, true);
          
          window.addEventListener('unhandledrejection', function(e) {
            if (e.reason && e.reason.message && 
                (e.reason.message.includes('localhost') || e.reason.message.includes('refused'))) {
              console.warn('ğŸ™ˆ æŠ‘åˆ¶Promiseæ‹’ç»: ' + e.reason.message);
              e.preventDefault();
              return false;
            }
          }, true);
          
          console.log('ğŸ‰ æ‹¦æˆªå™¨åˆå§‹åŒ–å®Œæˆ');
        } catch(e) {
          console.error('æ‹¦æˆªå™¨è®¾ç½®å¤±è´¥:', e);
        }
      })();
    </script>
    
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="åœ¨çº¿æ–‡ä»¶å·¥å…·é›†ï¼Œæ”¯æŒæ ¼å¼è½¬æ¢ã€å›¾ç‰‡å¤„ç†ç­‰åŠŸèƒ½"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    
    <!-- æ ¸å¿ƒæ‹¦æˆªå™¨ï¼šåœ¨æ‰€æœ‰å…¶ä»–è„šæœ¬ä¹‹å‰åŠ è½½ -->
    <script>
      (function(){
        console.log('ğŸ”’ HTMLæ—©æœŸæ‹¦æˆªå™¨å·²å¯åŠ¨');
        
        // é¢„å®šä¹‰æ•°æ®
        window.__fileFormatsFallback = {
          success: true,
          formats: [
            {
              name: 'Wordæ–‡æ¡£',
              extension: 'docx',
              targetFormats: [
                { name: 'PDFæ–‡æ¡£', extension: 'pdf' },
                { name: 'æ–‡æœ¬æ–‡ä»¶', extension: 'txt' }
              ]
            },
            {
              name: 'PDFæ–‡æ¡£',
              extension: 'pdf',
              targetFormats: [
                { name: 'Wordæ–‡æ¡£', extension: 'docx' },
                { name: 'æ–‡æœ¬æ–‡ä»¶', extension: 'txt' }
              ]
            },
            {
              name: 'Excelè¡¨æ ¼',
              extension: 'xlsx',
              targetFormats: [
                { name: 'CSVæ–‡ä»¶', extension: 'csv' },
                { name: 'PDFæ–‡æ¡£', extension: 'pdf' }
              ]
            },
            {
              name: 'å›¾ç‰‡',
              extension: 'jpg',
              targetFormats: [
                { name: 'PNGå›¾ç‰‡', extension: 'png' },
                { name: 'WebPå›¾ç‰‡', extension: 'webp' }
              ]
            }
          ]
        };
        
        // ç›´æ¥æ›¿æ¢æ•´ä¸ªXMLHttpRequestç±»
        var OriginalXHR = window.XMLHttpRequest;
        
        window.XMLHttpRequest = function() {
          var xhr = new OriginalXHR();
          var originalOpen = xhr.open;
          var originalSend = xhr.send;
          
          // æ‹¦æˆªopenæ–¹æ³•
          xhr.open = function(method, url) {
            // å­˜å‚¨åŸå§‹URL
            xhr._url = url;
            xhr._method = method;
            
            if (typeof url === 'string' && url.includes('localhost')) {
              console.error('ğŸ›‘ XHRæ ¸å¿ƒæ‹¦æˆª [' + method + ']: ' + url);
              
              // ç‰¹å®šå¤„ç†/file/formatsè¯·æ±‚
              if (url.includes('/file/formats')) {
                // ä¸æ”¹å˜URLï¼Œä½†åœ¨sendæ—¶æ‹¦æˆª
                console.log('æ£€æµ‹åˆ°æ ¼å¼è¯·æ±‚ï¼Œå‡†å¤‡æ‹¦æˆª');
              } else {
                // å¯¹å…¶ä»–è¯·æ±‚ï¼Œä¿®æ”¹ä¸ºä¸€ä¸ªæ— æ•ˆURL
                url = 'https://blocked-localhost-request/';
              }
            }
            
            return originalOpen.apply(xhr, arguments);
          };
          
          // æ‹¦æˆªsendæ–¹æ³•
          xhr.send = function() {
            if (xhr._url && typeof xhr._url === 'string') {
              // ç‰¹æ®Šå¤„ç†localhost:5002/api/file/formatsè¯·æ±‚
              if (xhr._url.includes('localhost') && xhr._url.includes('/file/formats')) {
                console.log('ğŸ”„ æä¾›é¢„è®¾æ ¼å¼æ•°æ®ï¼Œä¸å‘é€å®é™…è¯·æ±‚');
                
                // æ¨¡æ‹ŸXHRå“åº”å‘¨æœŸ
                setTimeout(function() {
                  // çŠ¶æ€å˜åŒ–
                  Object.defineProperty(xhr, 'readyState', { value: 4, writable: false });
                  Object.defineProperty(xhr, 'status', { value: 200, writable: false });
                  Object.defineProperty(xhr, 'statusText', { value: 'OK', writable: false });
                  
                  // è®¾ç½®å“åº”æ•°æ®
                  var response = JSON.stringify(window.__fileFormatsFallback);
                  Object.defineProperty(xhr, 'responseText', { value: response });
                  Object.defineProperty(xhr, 'response', { value: response });
                  
                  // è§¦å‘å›è°ƒ
                  if (xhr.onreadystatechange) xhr.onreadystatechange();
                  if (xhr.onload) xhr.onload();
                }, 0);
                
                return; // ä¸å‘é€è¯·æ±‚
              } else if (xhr._url.includes('localhost')) {
                console.warn('ğŸ›‘ é˜»æ­¢XHRè¯·æ±‚å‘é€: ' + xhr._url);
                
                // è§¦å‘é”™è¯¯å›è°ƒ
                setTimeout(function() {
                  if (xhr.onerror) xhr.onerror(new Error('è¯·æ±‚å·²è¢«é˜»æ­¢'));
                }, 0);
                
                return; // ä¸å‘é€è¯·æ±‚
              }
            }
            
            return originalSend.apply(xhr, arguments);
          };
          
          return xhr;
        };
        
        // æ›¿æ¢fetch
        var originalFetch = window.fetch;
        if (originalFetch) {
          window.fetch = function(resource, init) {
            var url = (resource instanceof Request) ? resource.url : resource;
            
            if (typeof url === 'string' && url.includes('localhost')) {
              console.error('ğŸ›‘ Fetchæ ¸å¿ƒæ‹¦æˆª: ' + url);
              
              // ç‰¹å®šå¤„ç†/file/formatsè¯·æ±‚
              if (url.includes('/file/formats')) {
                console.log('æä¾›é¢„è®¾æ ¼å¼æ•°æ®');
                return Promise.resolve(new Response(
                  JSON.stringify(window.__fileFormatsFallback),
                  { status: 200, headers: { 'Content-Type': 'application/json' } }
                ));
              }
              
              return Promise.reject(new Error('è¯·æ±‚å·²è¢«é˜»æ­¢'));
            }
            
            return originalFetch.apply(window, arguments);
          };
        }
        
        // æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†
        window.addEventListener('error', function(e) {
          if (e.message && (
              e.message.includes('localhost') || 
              e.message.includes('ERR_CONNECTION_REFUSED') || 
              e.message.includes('Failed to load resource')
          )) {
            console.warn('ğŸ™ˆ æŠ‘åˆ¶é”™è¯¯: ' + (e.message || 'æœªçŸ¥é”™è¯¯'));
            e.preventDefault();
            return false;
          }
        }, true);
        
        window.addEventListener('unhandledrejection', function(e) {
          if (e.reason && e.reason.message && (
              e.reason.message.includes('localhost') || 
              e.reason.message.includes('æ‹’ç»') || 
              e.reason.message.includes('refused')
          )) {
            console.warn('ğŸ™ˆ æŠ‘åˆ¶Promiseæ‹’ç»: ' + e.reason.message);
            e.preventDefault();
            return false;
          }
        }, true);
        
        // å»ºç«‹é”™è¯¯å¤„ç†å™¨çš„HTMLå…ƒç´ 
        var errorHandler = document.createElement('div');
        errorHandler.style.display = 'none';
        errorHandler.id = 'error-suppressor';
        document.head.appendChild(errorHandler);
        
        // ç›‘å¬DOMä»¥æŸ¥æ‰¾å¹¶éšè—é”™è¯¯æ¶ˆæ¯
        var observer = new MutationObserver(function(mutations) {
          document.querySelectorAll('.ant-message-error, .ant-alert-error').forEach(function(el) {
            if (el.textContent && (
                el.textContent.includes('æœåŠ¡å™¨è¿æ¥é”™è¯¯') ||
                el.textContent.includes('localhost') ||
                el.textContent.includes('failed')
            )) {
              console.log('ğŸ™ˆ éšè—UIé”™è¯¯æ¶ˆæ¯');
              el.style.display = 'none';
            }
          });
        });
        
        // å½“DOMåŠ è½½å®Œæˆåå¼€å§‹è§‚å¯Ÿ
        document.addEventListener('DOMContentLoaded', function() {
          observer.observe(document.body, { childList: true, subtree: true });
        });
        
        console.log('âš¡ HTMLæ—©æœŸæ‹¦æˆªå™¨è®¾ç½®å®Œæˆ');
      })();
    </script>
    
    <!-- æœ€æ—©æœŸæ‹¦æˆªlocalhostè¯·æ±‚çš„è„šæœ¬ -->
    <script>
      (function(){
        // åœ¨é¡µé¢åŠ è½½æœ€æ—©æœŸå°±åŠ«æŒæ‰€æœ‰ç½‘ç»œè¯·æ±‚æ–¹æ³•
        console.log('ğŸ”’ æœ€æ—©æœŸè¯·æ±‚æ‹¦æˆªå™¨å·²æ¿€æ´»');
        
        // å®šä¹‰ä¸€ä¸ªå¤„ç†å‡½æ•°æ¥å¤„ç†æ‰€æœ‰ç½‘ç»œè¯·æ±‚
        function blockLocalhostRequests(url) {
          if (typeof url === 'string' && (url.includes('localhost') || url.includes('127.0.0.1'))) {
            console.error('â›” æ ¸å¿ƒæ‹¦æˆª: ' + url);
            throw new Error('ç¦æ­¢localhostè¯·æ±‚');
          }
          return url;
        }
        
        // 1. æ‹¦æˆªXHR
        if (window.XMLHttpRequest) {
          var originalXHROpen = XMLHttpRequest.prototype.open;
          XMLHttpRequest.prototype.open = function(method, url) {
            try {
              url = blockLocalhostRequests(url);
            } catch (e) {
              // å¯¹äºXHRï¼Œæˆ‘ä»¬å°†URLé‡å®šå‘åˆ°ä¸€ä¸ªæ— æ•ˆåœ°å€
              url = 'https://invalid-blocked-request/';
              var self = this;
              setTimeout(function() {
                if (self.onerror) self.onerror(new Error('è¯·æ±‚å·²è¢«é˜»æ­¢'));
              }, 0);
            }
            return originalXHROpen.apply(this, [method, url].concat(Array.prototype.slice.call(arguments, 2)));
          };
        }
        
        // 2. æ‹¦æˆªfetch
        if (window.fetch) {
          var originalFetch = window.fetch;
          window.fetch = function(input) {
            try {
              if (typeof input === 'string') {
                blockLocalhostRequests(input);
              } else if (input instanceof Request) {
                blockLocalhostRequests(input.url);
              }
            } catch (e) {
              return Promise.reject(e);
            }
            return originalFetch.apply(this, arguments);
          };
        }
        
        // 3. æ·»åŠ å…¨å±€é”™è¯¯å¤„ç†ï¼Œéšè—ç‰¹å®šé”™è¯¯
        window.addEventListener('error', function(e) {
          // éšè—ç‰¹å®šçš„é”™è¯¯ä¿¡æ¯
          if (e.message && (
              e.message.includes('localhost') || 
              e.message.indexOf('Failed to load resource') !== -1 || 
              e.message.indexOf('net::ERR_CONNECTION_REFUSED') !== -1)
          ) {
            console.warn('ğŸ™ˆ éšè—é”™è¯¯:', e.message);
            e.preventDefault();
            return false;
          }
        }, true);
        
        console.log('âš¡ å…¨å±€æ‹¦æˆªå™¨è®¾ç½®å®Œæˆ');
      })();
    </script>
    
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>æ–‡ä»¶å·¥å…·ç®±</title>
    <!-- å¯¼å…¥æ€æºé»‘ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <noscript>æ‚¨éœ€è¦å¯ç”¨JavaScriptæ‰èƒ½è¿è¡Œæ­¤åº”ç”¨</noscript>
    <div id="root"></div>
  </body>
</html> 